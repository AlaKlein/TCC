---
  - name: MariaDB auto-install
    hosts: all
    become: yes
    become_user: root
    tasks:
      - name: Enable EPEL Repository on CentOS 7
        yum:
          name: epel-release
          state: latest

      - name: install updates
        yum: update_cache=yes

      - name: install maven
        yum: 
          name: maven
          state: latest

      - name: Install MariaDB
        yum:
          name: 
          - mariadb-server
          - python3-PyMySQL
          - MySQL-python
          state: latest

      - name: Start MariaDB
        service:
          name: mariadb
          enabled: true
          state: started

      - name: Install git
        yum:
          name: git
          state: present
          update_cache: yes

      - name: Clone a github repository
        git:
          repo: https://github.com/AlaKlein/Help-Desk.git
          dest: /usr/local/help-desk
          clone: yes
          update: yes

      - name: Create database user with password and all database privileges and 'WITH GRANT OPTION'
        mysql_user:
          name: admin
          password: admin
          priv: '*.*:ALL,GRANT'
          state: present

      - name: 'Create database'
        mysql_db: 
          name: TicketSystem
          state: present
          login_user: admin
          login_password: admin
          login_host: localhost

      - name: Restore database
        mysql_db:
          name: TicketSystem
          state: import
          target: /usr/local/help-desk/dump-ticketsystem-202106231058.sql

      - name: Install Java
        yum: 
          name: java-11-openjdk-devel 
          state: present

      - name: download tomcat server packages
        get_url:
          url: https://archive.apache.org/dist/tomcat/tomcat-10/v10.0.21/bin/apache-tomcat-10.0.21.tar.gz
          dest: /usr/local

      - name: extract tomcat packages
        unarchive:
          src: /usr/local/apache-tomcat-10.0.21.tar.gz
          dest: /usr/local
          remote_src: yes

      - name: Creates directory
        file:
          path: /usr/local/apache-tomcat-10.0.21/conf/Catalina/localhost
          state: directory

      - name: copy src.txt as dest.txt in the same dir 
        copy:
          #src: /usr/local/git/src/main/webapp/
          #dest: /usr/local/apache-tomcat-10.0.21/webapps/ROOT
          src: /usr/local/help-desk/tomcat_conf/
          dest: /usr/local/apache-tomcat-10.0.21/conf/Catalina/localhost
          remote_src: yes
        tags:
          - simple_copy

      - name: start tomcat services
        shell: nohup /usr/local/apache-tomcat-10.0.21/bin/startup.sh

      - name: Configure Maven Server
        lineinfile:
          insertafter: <servers>
          line: <server>    
                <id>Tomcat10</id>
                <username>admin</username>
                <password>admin</password>
                </server>
          path: /etc/maven/settings.xml